# Your MCP Server is Bad (and you should feel bad) - Jeremiah Lowin, Prefect

## 📹 视频信息

- **频道**: AI Engineer
- **发布日期**: 2026-01-12
- **时长**: 54:17
- **原始链接**: [https://www.youtube.com/watch?v=96G7FLab8xc](https://www.youtube.com/watch?v=96G7FLab8xc)

---

# Your MCP Server is Bad (and you should feel bad)

本文内容整理自 Prefect Technologies 创始人兼 CEO 耶利米·洛温（Jeremiah Lowin）在 AI Engineer 频道的技术演讲。

## TL;DR

FastMCP 创始人深度剖析 MCP 服务器设计的常见错误：大多数开发者把 MCP 服务器当作 REST API 来构建，忽视了 AI Agent 在发现、迭代和上下文处理上的根本局限性，导致服务器难用且低效。正确的做法是将其视为专门为 Agent 设计的用户界面。

## 📑 章节导航表

| 时间戳 | 章节标题 | 一句话概括 |
|--------|----------|-----------|
| 00:00-04:00 | 自我介绍与 FastMCP 背景 | 介绍 FastMCP 的惊人增长（日下载量 150 万）和演讲动机 |
| 04:00-10:00 | 为什么需要 MCP | 解释人类与 AI 在 API 使用上的根本差异 |
| 10:00-14:00 | MCP 服务器的常见问题 | 展示典型的"坏"服务器示例 |
| 14:00-18:00 | 原则一：成果而非操作 | 从原子操作转向完整工作流设计 |
| 18:00-22:00 | 原则二：扁平化参数 | 避免复杂嵌套参数，使用简单基础类型 |
| 22:00-27:00 | 原则三：指令即上下文 | 文档、示例和错误信息的重要性 |
| 27:00-32:00 | 原则四：尊重 Token 预算 | 800 个端点的反面案例分析 |
| 32:00-38:00 | 原则五：无情地精简 | 从 188 个工具精简到 5 个的案例 |
| 38:00-42:00 | 停止转换 REST API | 为什么直接转换 REST API 是最糟糕的做法 |
| 42:00-54:00 | Q&A 环节 | 讨论异步任务、工具耦合等高级话题 |

## 📊 核心论点

### 人类与 AI 在 API 使用上的三大根本差异

- **核心内容**：人类开发者使用 API 时，发现成本低（查一次文档即可）、迭代速度快（直接调用）、上下文丰富（有完整记忆）。而 AI Agent 每次连接都需要重新发现所有工具（消耗大量 token）、每次迭代都要发送完整历史（成本指数级增长）、只能记住最近 20 万个 token。这导致为人类设计的 API 对 AI 来说极其低效。
- **关键概念**：发现成本、迭代成本、上下文窗口、Token 预算、握手协议
- **实际意义**：MCP 服务器设计必须从根本上重新思考，不能简单复用现有 REST API 设计模式；需要专门为 AI 的限制进行优化设计。

### FastMCP 的爆炸性增长揭示的问题

- **核心内容**：FastMCP 日下载量达 150 万次，成为 MCP 生态的事实标准。但这也让作者看到了大量设计糟糕的 MCP 服务器。最常见的问题是开发者直接将 REST API 转换为 MCP 服务器，导致 Agent 需要多次调用才能完成简单任务。这暴露出整个行业缺乏"为 Agent 设计产品"的意识和方法论。
- **关键概念**：FastMCP、MCP 生态系统、REST API 包装器、Agent 产品设计、开源维护
- **实际意义**：急需建立 MCP 最佳实践标准；开发者需要转变思维，将 MCP 服务器视为用户界面而非 API；社区需要更多高质量的示例和指导。

### 成果优于操作：重新定义工具粒度

- **核心内容**：传统 REST API 设计强调原子操作（获取用户、获取订单、检查状态），这对人类开发者很好但对 Agent 很糟糕。Agent 不应该充当编排器，将多个 API 调用组合成工作流。正确做法是提供高层次的、面向成果的工具（如"追踪最新订单"），在服务器端完成所有必要的调用序列。
- **关键概念**：原子操作、Agent 编排、工作流封装、一个工具等于一个故事、自上而下设计
- **实际意义**：减少 Agent 的迭代次数和出错概率；大幅提升执行效率；让 Agent 专注于决策而非流程控制。

### Token 预算的数学现实

- **核心内容**：某大型公司想暴露 800 个 API 端点给 Agent。假设 20 万 token 的上下文窗口，每个工具只能分配 250 个 token（包括名称、参数、文档）。即使每个工具都精简到极致，握手时就会耗尽所有上下文，Agent 将无法执行任何实际工作。GitHub MCP 服务器在握手时发送约 20 万个 token 就是一个反面例子。
- **关键概念**：Token 预算、握手成本、上下文窗口、工具数量上限、渐进式披露
- **实际意义**：50 个工具是性能开始下降的临界点；必须无情地精简工具数量；需要创新的解决方案（如按需加载、命名空间分离）。

### 错误信息即提示词：独特的设计机会

- **核心内容**：与传统 API 返回错误代码不同，MCP 的错误信息会直接成为 Agent 下一轮对话的输入。这创造了独特的设计机会：可以在错误信息中提供详细的恢复指导、参数说明或替代方案。某些复杂 API 甚至可以故意让第一次调用失败，通过错误信息进行渐进式信息披露。
- **关键概念**：错误即提示、渐进式披露、错误恢复指导、上下文敏感帮助、友好错误设计
- **实际意义**：将错误处理从防御性编程转变为主动引导；减少文档复杂度；提高 Agent 的自主问题解决能力。

### Claude Desktop 的合规性问题

- **核心内容**：Claude Desktop 作为 Anthropic 的旗舰产品，却存在严重的 MCP 规范违规。它会在首次连接时哈希所有工具并存入 SQLite 数据库，忽略后续的动态更新。它还会将结构化参数强制转换为字符串。这迫使 FastMCP 等框架必须添加变通方案，破坏了规范的一致性。
- **关键概念**：客户端合规性、规范遵循、SQLite 缓存、字符串强制转换、生态系统碎片化
- **实际意义**：MCP 生态系统仍不成熟；服务器开发者必须为各种客户端缺陷做防御性设计；需要更好的客户端实现标准。

### 从 REST API 到上下文产品的演进

- **核心内容**：MCP 目前被视为基础设施或传输技术，但作者预测一年内将演变为"上下文产品"的新范式。这意味着从关注协议细节转向关注如何为 Agent 提供最佳用户体验。就像人类不直接使用 API 而使用产品一样，Agent 也应该有专门为其优化的界面。
- **关键概念**：上下文产品、Agent UX、产品思维、界面设计、用户体验
- **实际意义**：MCP 开发将从工程师主导转向产品设计主导；需要新的设计模式和评估标准；为 AI-first 产品开辟新赛道。

### 异步任务的新可能（SEP 1686 提案）

- **核心内容**：新的 MCP 规范提案支持异步后台任务，客户端可以选择让某些操作在后台运行并稍后查询结果。这不改变现有设计原则，但为长时间运行的任务提供了更好的体验。关键是这是客户端选择性功能，服务器设计者需要判断哪些任务适合异步执行。
- **关键概念**：异步任务、SEP 1686、客户端选择、轮询机制、阻塞vs非阻塞
- **实际意义**：解决了 MCP 的一个关键限制；为数据处理、文件生成等耗时操作提供更好方案；提升整体系统响应性。

### 工具参数的耦合问题

- **核心内容**：紧密耦合的参数（如文件类型决定处理选项的有效值）会让 Agent 困惑。传统 API 可以通过文档说明这种依赖关系，但 Agent 很难理解这种条件逻辑。解决方案包括：将耦合参数合并为单一选择、使用不同工具处理不同场景、或通过 elicitation 机制分步收集信息。
- **关键概念**：参数耦合、条件逻辑、工具拆分、elicitation、分步收集
- **实际意义**：简化 Agent 的决策树；减少无效调用；提高首次成功率。

### 社区最佳实践的崛起

- **核心内容**：Block 和 GitHub 等公司开始发布详细的 MCP 设计指南，分享实战经验。Kelly Kinkade 的博客展示了从 188 个工具精简到 5 个的真实案例。这些实践强调自上而下的工作流设计、语义路由、工具命名策略等。社区正在形成共识：好的 MCP 服务器需要产品思维，而非纯工程思维。
- **关键概念**：最佳实践、设计模式、社区标准、案例研究、知识分享
- **实际意义**：加速整个生态系统的成熟；新开发者可以避免常见陷阱；推动 MCP 从实验阶段走向生产级应用。

## 🏢 提及的公司/产品

| 公司名 | 讨论语境 | 重要性 |
|--------|----------|--------|
| Anthropic | MCP 协议创建者、Claude Desktop 开发商、生态系统推动者 | ⭐⭐⭐ |
| Prefect Technologies | 演讲者公司、数据自动化和编排软件提供商 | ⭐⭐ |
| Block | MCP 最佳实践先驱、发布优秀设计指南 | ⭐⭐⭐ |
| GitHub | 大规模 MCP 服务器案例（170+ 工具）、语义路由创新 | ⭐⭐⭐ |
| Apache Airflow | 演讲者的开源背景、工作流编排领域经验来源 | ⭐ |
| Fiverr | Kelly Kinkade 的雇主、MCP 精简案例来源 | ⭐⭐ |

## 💬 经典金句

> "An agent can find a needle in a haystack. The problem is it's going to look at every piece of hay and decide if it's a needle."
> — Jeremiah Lowin

> "Humans don't use APIs. We do anything we can to put something between us and an API."
> — Jeremiah Lowin

> "You are not building a tool. You are building a user interface."
> — Jeremiah Lowin

> "Errors are prompts."
> — Jeremiah Lowin

> "Examples are contracts."
> — Jeremiah Lowin

## 👤 主要人物

### Jeremiah Lowin（耶利米·洛温）

**身份**：Prefect Technologies 创始人兼 CEO；FastMCP 创建者；前 Apache Airflow PMC 成员
**背景**：在数据自动化和工作流编排领域深耕 7-8 年。创建了 AI Agent 框架 Marvin，随后开发了 FastMCP，后者成为 MCP 生态系统中最流行的高级框架，每日下载量达 150 万次。
**核心观点**：MCP 服务器应该被视为专门为 AI Agent 设计的用户界面，而不是简单的 API 包装器。开发者必须理解 Agent 在发现、迭代和上下文处理上的根本局限性，并据此设计服务器。他提出了五大设计原则：关注成果而非操作、扁平化参数、指令即上下文、尊重 Token 预算、无情地精简。

### David（来自 Anthropic）

**身份**：Anthropic 工程师，MCP 协议核心贡献者
**背景**：在 MCP 发布后不久联系了 Lowin，认可 FastMCP 的设计理念，并将其部分功能集成到官方 SDK 中
**核心观点**：支持 FastMCP 作为 MCP 生态的高级接口，而官方 SDK 专注于底层原语

### Kelly Kinkade

**身份**：Fiverr 工程师，MCP 实践者
**背景**：撰写了两篇具有代表性的博客文章，记录了构建 MCP 服务器的完整历程
**核心观点**：通过实践展示了从 188 个工具精简到 5 个工具的必要性，强调"先让它工作，再让它优秀"的产品迭代思路

## 📺 视频类型判断

**访谈对话**：技术演讲形式，包含现场 Q&A 互动环节

---

## 📝 完整翻译

### (0:00 - 8:00) Part 1

**(0:00 - 1:20)**

真的很感谢大家能来到这里。我会尽量让这次演讲不那么痛苦。我们不会做互动环节，而是直接讲内容。我很乐意偏离脚本，如果有任何想要探讨的内容，我也很乐意在任何时候回答问题。我的目标是想与大家分享我学到的很多东西，我会尽量让它们尽可能具有可操作性。所以这里会有真正可以做的事情，比我们在更高层次的演讲中可能涉及的内容更多。但说实话，现在很晚了，内容很多也很长。让我们来谈谈 MCP。

**(1:20 - 2:40)**

我希望在座的各位对 MCP 感兴趣，这也是你们来听这次演讲的原因。如果你们是来学习 MCP 的，这可能会有一点不同的角度。举手看看，听说过 MCP 的？用过 MCP 的？写过 MCP 服务器的？好的，有人对 MCP 感到不舒服吗？这完全没问题，我们可以调整。好的，那我觉得我们直接开始吧。

这是我的身份。我是一家叫 Prefect Technologies 公司的创始人兼 CEO。在过去七八年里，我们一直在构建数据自动化软件和编排软件。在此之前，我是 Apache Airflow PMC 的成员。我最初创立 Prefect 是为了将这些编排理念推广到数据科学领域。如今，我们运营着完整的技术栈。

**(2:40 - 4:00)**

然后几年前，我开发了一个叫 Marvin 的智能体框架。我不会说它非常受欢迎，但它是我进入 AI 世界的敲门砖，至少从开发者体验的角度来说是这样，我从中学到了很多。最近，我推出了一个叫 fastmcp 的软件，它非常非常受欢迎，可能太受欢迎了。这就是我今天身份的由来。我有点不知所措。我发现自己又回到了开源维护者的位置，这是我几年来没有经历过的，虽然非常有趣。但最重要的是，fastmcp 给了我一个非常特殊的视角，这正是今天这次演讲的基础。

**(4:00 - 5:20)**

这是我们的下载量。我从未见过这样的情况，从未参与过这样的项目。昨天它被下载了一百五十万次。外面有很多 MVP 服务器，fastmcp 已经成为构建 MCP 服务器的事实标准方式。我在差不多一年前推出了它。正如你们很多人可能知道的，MCP 本身也是在差不多一年前推出的，几天后我就推出了 fast MCP 的第一个版本。Anthropic 的 David 给我打电话说他认为这很棒，他认为这是人们应该构建服务器的方式。我们将它的一个版本放入了官方 SDK 中，这太棒了。

**(5:20 - 6:40)**

随着 MCP 在去年疯狂发展，我们发现将 fast MCP 定位为 MCP 生态系统的高层接口实际上是建设性的，而 SDK 专注于底层原语。实际上，我们将在几个月内从底层 SDK 中移除 fastmcp 词汇，因为有两个叫 fast MCP 的东西太令人困惑了。所以 fast MCP 将成为世界的高层接口。因此，我们看到很多不太好的 MCP 服务器。我用这个 meme 来命名这次演讲，然后我想到，人们还知道这个 meme 是什么吗？对我来说这很有趣也很贴切，但它来自1999年的《飞出个未来》剧集。如果你们没看过这个，我演讲的标题并不是要刻薄。我算是个乐观主义者，我选择将其解读为"但你可以做得更好"。

**(6:40 - 8:00)**

所以我们要找到做得更好的方法。这就是今天演讲的目标。实际上，更准确地说，我今天真正想做的是为智能体产品设计建立直觉。考虑到今天有多少智能体在使用多少产品，我发现这个话题的讨论远远不够。我的意思是，这与我如果要做一场关于如何为用户、为人类构建好产品的演讲是完全类似的。我们会谈论人机界面指南、用户体验和用户故事。我发现从智能体的角度开始讨论这些事情真的很有启发性，因为 MCP 服务器不就是智能体的接口吗？我们应该针对这些智能体的优势和劣势来设计它，就像我们对待其他一切事物一样。

当我将这个想法表达出来时，我非常非常频繁地得到这样的反驳："如果人类可以使用 API，为什么 AI 不能？"这个问题有很多错误之处，第一个错误是它有一个假设，我在很多 AI 产品设计中都看到这个假设，这让我抓狂，就是认为 AI 是完美的，或者它们是神谕，或者它们擅长一切。它们确实是非常强大的工具，但基于你们之前的回应，我认为这个房间里的每个人都有一些伤疤，证明了它们是易错的、有限的，你知道，不完美的。所以我不喜欢这个问题，因为它假设它们在一切方面都神奇地惊人。

### (8:00 - 16:00) Part 2

**(8:00 - 9:15)**

它只有过去 20 万个 token 的记忆范围。这就是它记忆的全部范围，再加上嵌入在权重中的任何信息，就这些了。所以我们需要非常非常清楚地认识到，目前它的"大脑"非常小。我觉得这更像是人们谈论的阿波罗 11 号登月时只有 1KB 内存那样的情况。我认为这才是我们应该如何思考这些事情的方式，尽管它们感起来相当神奇，因为它们会帮我开 PR 或做其他事情。

**(9:15 - 10:30)**

所以在我看来，这就是三个关键维度的不同之处，我们不应该在这些维度上构建适合人类的 API，然后假装它们对智能体也是好的。我开始谈论这个概念的一种方式是：智能体可以在干草堆中找到一根针。问题是它会查看每一根草，然后判断它是否是针。这虽然不是字面意思，但从直觉上来说，这就是我们应该如何思考我们放在智能体面前的东西以及我们如何提出问题的方式。

**(10:30 - 11:45)**

MCP 服务器本质上就是解决那个问题或方案的接口。所以最后回到我们的产品直觉声明，我向你们论证了，对于 MCP 开发者来说，宇宙中最重要的词就是"策划"（curate）。如何从大量可能适合人类开发者的信息中策划出一个适合这些在我们刚才讨论的维度上极其受限的 AI 智能体的接口？这就是我们要解决的问题。

**(11:45 - 13:00)**

这让我们来到了这张幻灯片：为什么要用 MCP？我差点把这张做成德里克·祖兰德那样的幻灯片，"但是为什么要 MCP？"就像"德里克，我刚告诉了你为什么要 MCP。"因为它做了所有这些事情。它给了我们一种标准的方式来向智能体传达信息，这种方式是可控的，我们不仅可以控制信息如何被发现，还可以控制如何对其采取行动。这里有个大星号，因为目前 MCP 领域的客户端实现并不完美，它们做的一些事情本身就不符合 MCP 规范。

**(13:00 - 14:15)**

也许最后我们会讨论这个问题。现在这不是直接相关的，除了我们能做的就是尽我们所能构建最好的服务器，但要受制于使用它们的客户端的限制。当然，我在这里放了这个，我认为对于这个观众我们不需要详细介绍 MCP 是什么，所以我们会快速通过这个。但是，当然，为了记录，老套的说法是它是互联网的 USB-C。它是连接 LLM 和工具或数据的标准方式。

**(14:15 - 16:00)**

如果你还没有看过 FastMCP，这就是构建一个完全功能的 MCP 服务器的样子。这个例子，我住在华盛顿特区，那里的地铁经常着火，所以这个检查地铁是否着火，确实如此。现在我们要真正探索的问题是：为什么有这么多糟糕的 MCP 服务器？也许更好的问题是，你们都同意我的观点吗，即有很多糟糕的 MCP 服务器？我有点像把这个当作事实来宣布。我不是想做一个有争议的声明。世界上确实有很多糟糕的 MCP 服务器。我看到很多这样的服务器，因为人们在用我的框架来构建它们。这让任何人感到惊讶吗，我在这样宣布？我真的很好奇这是否是我做出的假设。

观众：根据我的经验，我不会说每个 MCP 都是这样，但很多都像是 AI 包装器。它们只是把 API 的内容字符串化，就这样。

它们称之为 MCP。是的，我甚至会论证，稍微偏离脚本，但我会论证，很多即使不是包装器的服务器也只是糟糕的产品，因为没有人思考过它们。我的意思是，我有时和团队讨论的一个比较是，如果你去一个糟糕的网站，你知道它是个糟糕的网站。我们不需要坐在那里弄清楚为什么它丑陋、难用、难找到你要找的东西，或者全是闪光。我不知道什么确切地构成一个糟糕的网站，但当你访问一个时你就知道它是糟糕的网站。

### (16:00 - 24:00) Part 3

**(16:00 - 17:15)**

缓慢、恼人、难以调试且具有随机性。所以如果你能避免这种情况，请务必避免。如果你无法避免，有时你不知道算法是什么，不知道如何编写代码，这不是程序化的，那就是使用 LLM 作为编排器的完美时机。查询订单状态，这是一个非常糟糕的时机，选择使用 LLM 作为编排服务是一个非常昂贵的时机。所以不要这样做，而是要专注于这种"一个工具等于一个代理"的故事。即使在这里，我们也在试图引入新的词汇。这不是用户故事，因为用户故事让每个人都想到人类，尽管它确实是一个用户。这是一个代理故事。这是一个程序化的自主代理，具有目标和有限的上下文窗口正在试图实现的东西，我们需要尽可能满足它。

**(17:15 - 18:30)**

然后这是那些感觉显而易见但我认为很重要的小技巧之一。为代理命名工具。不要为你自己命名。这不是 REST API。它不应该对需要编写的未来开发者清晰，你不是在为变更编写 API。你正在编写 API，以便代理在正确的时间选择正确的工具。不要害怕为你的工具使用愚蠢但具有解释性的名称。我不应该说愚蠢。它们可能感觉有点愚蠢，但在这个时刻它们非常面向用户，尽管它感觉像一个深层的 API。

**(18:30 - 19:45)**

以防你们中的任何人没有去阅读博客文章，我发现这个部分非常重要，他们基本上说了非常相似的话。从工作流程自顶向下设计，而不是从 API 端点自底向上。两种不同的方式到达同一个地方，但它们会产生非常不同的产品思维形式和非常不同的 MCP 服务器。所以我真的鼓励你们去看看那篇博客文章。如果我们回到我刚才向你展示的糟糕代码示例并开始重写它，如果我们有笔记本电脑，欢迎你们拿出笔记本电脑跟着做。代码基本上会运行，但没有必要。

**(19:45 - 20:50)**

这就是它可能的样子。我们做了你作为人类会做的事情。我们按顺序进行了三个配置调用到我们的 API，但我们将它们埋在一个面向代理的工具中。这就是我们如何从操作转向结果。API 调用仍然必须发生。这里没有魔法。但问题是，我们是要求代理弄清楚结果以及如何将它们拼接在一起来实现它，还是我们要直接做，因为我们知道如何代表它来做。所以第一件事是结果胜过操作。

**(20:50 - 22:00)**

第二件事，另一件事，坦率地说，当我大声说出来时，这些很多都会显得有点愚蠢。请相信我从下载图表中得出的这些是我能提供的最重要的建议。如果这些都不适用于你，认为你自己是前1%的 MCP 开发者。扁平化你的参数。我经常看到这种情况，我自己也这样做。我会向你承认，你说这是我的工具，其中一个输入是配置字典，希望它在某个地方有文档记录，也许在代理的指令中，也许在文档字符串中。

**(22:00 - 23:10)**

顺便说一下，我不记得我是否稍后有这个要点，所以我现在就说。你可能陷入的一个非常频繁的陷阱是，对于复杂的参数，你会将如何使用它们的解释放在系统提示或子代理定义之类的地方，然后你会在服务器中更改工具，现在它几乎比文档记录不良的工具更糟糕。你有一个双重文档化的工具，一个是错误的，一个是正确的，只有错误消息能拯救你。这真的很糟糕。这是一个更温和的版本。不要要求你的 LLM 发明复杂的参数。现在你可能会问，如果它是一个 Pydantic 模型，每个字段都有注释，那很好，这比字典要好，但仍然会很困难。

**(23:10 - 24:00)**

直到最近，可能仍然存在一个错误，也许它不是错误，因为似乎没有人修复它，但在 Claude Desktop 中，所有结构化参数，如对象参数，都会作为字符串发送，这创造了一个真正的问题，因为我们不想支持自动字符串转换为对象，但 Claude Desktop 是最受欢迎的 MCP 客户端之一，所以我们实际上出于必要性屈服于此。所以 FastMCP 现在会尝试，如果你向明显是结构化对象的东西提供字符串参数，它会尝试反序列化它。它会尝试做正确的事情。我真的讨厌我们必须这样做。这对我来说感觉非常错误，我们有一个类型模式说我需要一个对象，但我们正在做这样的补救措施。

### (24:00 - 32:00) Part 4

**(24:00 - 25:15)**

我昨天在构建 MCP 服务器时遇到了这个标签问题，真的让我很困惑。无论我怎么说"至少使用 10 个标签"，它总是只用两个。最后我发现是因为我的一个示例中只有两个标签。所以是的，好的策略，但可能不足以克服这些基本缺陷。

我确实有一些契约的示例。抱歉，我们讲到第 37 点了。我认为这张幻灯片上最有趣的一点是：错误就是提示。

**(25:15 - 26:30)**

从工具返回的每个响应，你的 LLM 并不知道它是错误的。它不会像收到 400 或 500 状态码那样。它看到的是关于自己未能成功完成尝试任务的信息。所以如果你只是让 Python（在 FastMCP 的情况下）或你选择的工具抛出一个空值错误或一个带有整数代码的神秘 MCP 错误，这些信息会返回给你的 LLM。它知道该如何处理吗？可能它至少知道要重试，因为它知道这是一个错误，但你实际上有机会通过错误来记录你的 API。

**(26:30 - 27:45)**

这引出了一些有趣的策略，我不想完全赞同，但我会提到。例如，如果你确实有一个复杂的 API，因为你无法摆脱这种复杂性，那么与其在记录整个工具的文档字符串中记录每种可能性，你实际上可以记录如何从最常见的失败中恢复。

这是一种非常奇怪的信息渐进式公开形式，你承认这个代理很可能第一次调用就会出错，但基于它出错的方式，你实际上有机会在错误消息中发送更多信息。

**(27:45 - 28:50)**

正如我所说，这不是构建软件的绝佳方式，但这是我所推荐的终极版本，即在错误消息中尽可能有帮助。确实要过度一些。对于代理来说，这些错误消息成为其下一个提示的一部分。所以它们确实很重要。如果它们太激进或太可怕，代理可能会永久避免使用该工具。它可能会认为这个工具无法操作。所以错误真的很重要。

我认为这不需要太多解释，但这就是当你有完整的文档字符串和示例时的样子。Block 在他们的博客文章中提到了一个我没有看到广泛使用的观点，尽管 ChatGPT 在其开发者模式中确实利用了这一点，那就是只读提示。

**(28:50 - 30:00)**

MCP 规范支持注释，这是你可以放置在各种组件上的注释的受限子集。其中一个工具注释是它是否是只读的。如果你可选地提供这个，客户端可以选择稍微不同地处理该工具。

只读提示背后的动机基本上是帮助设置权限。我不知道这里有谁是 YOLO 或危险禁用权限的粉丝，无论它们在不同终端中叫什么，但如果你不关心这个，那就无所谓。但例如，如果工具没有设置此注释，ChatGPT 会要求你额外的权限，因为它假设工具可能产生副作用并可能产生不良影响。所以利用这些来获得优势。这是客户端可以选择提供更好体验的另一种设计形式。

**(30:00 - 31:15)**

我现在已经谈论过这一点了。尊重 Token 预算。我认为现在的说法是 GitHub 服务器在握手时会发送大约 20 万个 Token 之类的。这是真实存在的问题。我不认为这会让 GitHub 服务器自动变坏。我认为这实际上让像我这样构建框架的人和构建客户端的人有责任找到真正解决这个问题的方法，因为答案不能总是"做得更少"。事实上，现在我们想要做更多。我们想要功能的丰富性。

**(31:15 - 32:00)**

所以我们稍后可能会谈论这一点。但对 Token 预算的尊重真的很重要。这是一个非常稀缺的资源，你的服务器不是代理要与之交谈的唯一服务器。

我最近与我的一个客户通话，他们非常兴奋地推出 MCP，我与工程团队会面了。需要明确的是，这是一家我极其尊敬的、具有前瞻性思维、高绩效的大型公司。我不会说他们是谁，但我真的很尊敬他们。他们接通电话时非常兴奋，他们说："我们正在将我们的东西转换为 MCP，这样我们就可以使用它了。"

### (32:00 - 40:00) Part 5

**(32:00 - 33:10)**

它将所有内容缓存在 SQLite 数据库中，所以无论你做什么都无所谓。你描述的这些技术很不错，比如提供机制来了解更多工具信息，这是个很棒的想法，我真的很喜欢。但这里有个挑战，现在你又回到了某种扁平化参数的世界，因为你现在有了元工具，我需要使用工具来了解工具，在某些极端情况下还要使用工具来调用工具，所以你需要非常仔细地设计这个系统。这就是为什么它通常会作为一个专门的产品出现。谢谢你的分享。确实有很多非常有趣的技术来尝试解决这个问题。

**(33:10 - 34:25)**

主持人：你谈到了渐进式披露。你是否使用遮罩技术？比如说，我连接到我的 Kubernetes 服务器，我的凭证只给了我某些权限，所以有 28 个工具我无法访问，因此你就不需要显示那些工具。

你是问我是否支持这个功能？你指的是 MCP 是否支持这个，还是我的产品是否支持这个？

主持人：是的，我只是在询问我读到的一些内容。

**(34:25 - 35:40)**

好的。所以规范对此没有声明。规范说当你调用 list tools 时，你会得到工具列表，但这是如何发生的取决于具体实现。FastMCP 通过中间件使这成为一个可重写的钩子，但同样没有声明这是如何实现的。我们的商业产品（我不是来推销的）允许在任何基础上进行每个工具的遮罩。我们认为这是在商业领域有观点的地方，而不是在开源领域有观点，也不是协议应该有任何观点的地方。如果这让你感兴趣，我们可以聊聊这个。

**(35:40 - 36:55)**

你可能会遇到这个问题，但如果你采用 J 刚才提到的目录方法，比如分成四个不同的块，或者可能那 800 个工具不都需要有自己的服务器，他们的解决方案是什么？

对他们来说，他们做不到，没有解决方案能让他们在联络中心窗口上拥有想要的那么多信息，他们不需要那些信息。这就变成了一个设计问题。坦率地说，这个电话大概是四个月前的事了，就是一个接一个的电话，不停地讨论这个问题。这让我意识到我们需要更多像今天这样的讨论，谈论如何为代理设计产品。

**(36:55 - 38:10)**

我担心的是 MCP 被视为基础设施或传输技术，虽然它确实是，我也很兴奋。我认为一年后我们会讨论上下文产品而不是 MCP 服务器。我对此很兴奋，我们将超越传输层面。但我们需要弄清楚如何使用它，所以我认为这就是我们讨论的方式。当你遇到这样的问题时，我与一些人和公司讨论过的唯一其他替代方案是，如果你控制客户端，就会有更多有趣的选择。如果你能指导客户端以某种特定方式做事，比如你有一个移动应用，向最终用户展示代理界面，这就是我所说的你控制客户端。

**(38:10 - 39:25)**

或者如果这是内部的，你可以规定团队使用什么客户端或什么定制客户端。现在你可以做更多有趣的事情，因为你实际上对令牌预算了解得更多，知道如何优化它。但对于面向外部的服务器，没有好的解决方案。

我想到现在我们已经讨论了所有这些内容。为了节省时间，我就把它留给后人吧。我们在这次演讲的早些时候谈到了"策展"作为一个关键动词。我认为，这就是我们在每一个小片段中对代码所做的事情。我们正在将同一信息集策展成对代理来说更易修改和更易识别的版本。

**(39:25 - 40:00)**

50 个工具是我划定的界限，超过这个数量你就会遇到性能问题。我知道这对很多人来说似乎真的很少。有些人甚至会说更少，有些人可能会说更多。如果你的服务器上有超过 50 个工具，在不了解其他情况下，我会开始认为这不是一个好的服务器。GitHub 服务器有大概 170 个工具。这是否意味着它不是一个好的服务器？不是的。这有一个很好的论据。GitHub 团队发布了很多关于他们正在进行的语义路由的有趣博客文章。实际上他们昨天刚发了一篇，介绍了一些他们使用的有趣技术。

### (40:00 - 48:00) Part 6

**(40:00 - 40:45)**

所以，这些是我们今天在这个伪工作坊（其实并不真的是工作坊）的可执行演讲中讨论的五大要点。结果导向，而非操作导向。专注于工作流。采用自上而下的方式。不要陷入所有琐碎的操作细节中。除非绝对必要，否则不要让你的代理成为编排者。扁平化你的参数。尽量不要传输大型有效载荷。尽量不要让代理感到困惑。尽量不要给它太多选择。

**(40:45 - 41:30)**

我想在谈到这个时没有大声说出来，但尽量不要有紧耦合的参数。这真的会让代理感到困惑。看看你能否在设计时绕过这个问题。如果可能的话——虽然并不总是可能——但如果可以的话，指令即上下文。大声说出来似乎很明显。它们当然是上下文，它们是为代理提供的信息。将它们作为上下文使用。将它们设计为上下文。真正用心思考你的指令，就像思考你的工具签名和模式一样。

**(41:30 - 42:15)**

尊重 Token 预算。必须这样做。这是这个列表上唯一一个，如果你不真正执行的话，你根本就不会有一个可用的服务器。其他的你可以勉强应付，坦率地说，这种直觉的艺术就是从这些规则开始，然后向实用性倒推。但这是唯一一个我认为你不能跨越界限的。然后如果你什么都不做的话，就要无情地策展。从有效的东西开始，然后将其精简到本质。

**(42:15 - 43:00)**

我写 MCP 服务器的时间可能和现在任何人一样长了，大约一年，我仍然发现自己有时一开始就在世界中放入太多工具，因为我不确定它会使用哪个，或者我在做实验，我必须提醒自己回去删除它们，这很困难。我认为作为工程师，尤其是设计常规 API 时，你会想"好吧，这是我的工具，这是 v2，向后兼容，对吧？"你会继续添加内容，这是一种非常自然的工作方式，可能是最佳实践，但在这里行不通。

**(43:00 - 43:45)**

这就像使用一个只向用户展示 REST API 的 UI 一样。这是我有时对自己产品的批评，当我觉得"这看起来有点太像我们的 REST API 文档了，对吧？我们没有很好地完成我们的工作，以一种用户可消费的方式真正将其提供给用户。"所以如果我只能给你留下一个想法的话，就是这个。你不是在构建一个工具，你是在构建一个用户界面，并且要像对待用户界面一样对待它，因为这是你的代理将要使用的界面。

**(43:45 - 44:30)**

你可以做得更好，也可以做得更糟，无论你还是你的用户都将从中受益。我觉得我们的时间到了，所以我要开放提问环节，讨论接下来做什么，或者我们可以解决哪些其他挑战。我希望在星期六下午 4:54 不需要你写任何代码的情况下，我找到了对你们都有用的东西之间的平衡点。但我希望我为你们提供了一些有用的见解，比你们进来时了解的更多。如果有任何问题，我很乐意回答。

**观众：** 什么是典型的？

**(44:30 - 45:15)**

那就是你有一个参数，比如文件类型是什么，另一个参数是我们应该如何处理文件，而你对文件类型参数的输入决定了另一个参数的有效输入。所以它们现在紧耦合了。第二个参数上的一些参数根据你为第一个参数说的内容而无效。这只是需要跟踪的额外事情。这是个好问题，抱歉我没有定义那个。

你有问题吗？

**观众：** 我从第一个开始。当你给代理一个实体服务器时，你必须在服务器中和代理中记录工具或服务器的能力，这不太理想。所以你会推荐什么，还是只在服务器中？

**(45:15 - 46:00)**

这归结为你是否控制客户端。如果你控制客户端，那么这是一个真正的选择，有不同的思考方式。例如，在我写的一些我知道我会使用的内容中，比如 Claude Code 来访问，我实际上可能会将我的 MCP 服务器记录为文件或 Claude 技能，因为我知道工作流程将会是什么样的。我知道我的一些工作流程不频繁，我不想用它们污染上下文空间。

**(46:00 - 46:45)**

所以，如果你控制客户端，你确实有一个真正的选择。如果你不控制客户端，那么你就没有太多选择。你必须在这里记录它，因为你必须假设你正在使用最糟糕的客户端。老实说，MCP 空间中的许多答案归结为：你控制客户端吗？然后你可以在协议的两端做非常有趣的事情。从服务器作者的角度来看，你确实需要在其文档字符串中记录所有内容。

**(46:45 - 47:30)**

一个逃生舱口是你可以记录服务器本身。所以每个服务器都有一个指令字段。并非每个客户端都遵守它。我相信我的团队已经提交了我们确定是这种情况的错误报告。希望这不是永久性的，但大多数客户端在握手时不仅会下载工具和资源以及所有内容，还会下载服务器本身的指令块。你可以在那里放置多少信息，我会小心。我不认为它想要读一本小说。但你确实有这一个额外的机会来记录你服务器的高层次内容。

**观众：** 还有一个问题，但...

**主持人：** 好的，让我们混合一下，我们会回来的。你有问题吗？

**观众：** 是的。

**(47:30 - 48:00)**

**主持人：** 我不是核心委员会成员，但我与他们保持密切联系。所以也许我可以回答你的问题。

**观众：** 我对这个非常兴奋。

**主持人：** 是的，我对此了解很多。

**观众：** 这将扩展。它实际上不会改变太多，因为它的实现方式。你能回答什么问题，比如它是什么？

**主持人：** 我对此感到兴奋吗？我对此感到兴奋。

### (48:00 - End) Part 7

**(48:00 - 49:15)**

是的，这种情况确实经常发生，但在你提到这一点之前，我没有把它当作一种模式来思考，但我确实见过很多次。这是一个真正的问题。也许我们会写一篇关于这个问题的博客文章，那会很有趣。

是的，规则仍然适用。但就 elicitation（征求）而言，你如何做到这一点呢？elicitation 真的很有趣。现在我们进入了高级 MCP elicitation。有人不熟悉这是什么吗？

**(49:15 - 50:30)**

elicitation 基本上是一种在工具执行中途向客户端请求更多输入的方式。你使用工具的初始参数，然后进行 elicitation。这是一个正式的 NCP 请求，你说"我需要更多信息"。它是结构化的，这一点很酷。在支持它的客户端中最常见的用例是需要批准的情况，你说我需要一个是或否的答案，看我是否可以继续进行某些不可逆的副作用或类似的操作。当它工作时，效果非常好。

**(50:30 - 51:45)**

这又是那种没有很好客户端支持的功能之一，因此很多人不会将其放入他们的服务器中，因为如果你发送这个请求而客户端不知道如何处理它，就会破坏你的服务器。所以你必须小心一点。这是否改变设计是一个很好的问题。我希望它被更多地使用，这样我就可以说是的，你应该依赖它。

如果所有客户端都支持它并且被广泛使用 - 顺便说一句，并不是所有客户端都支持这个功能，我不是在说客户端不好。处理 elicitation 很复杂，因为有些客户端是面向用户的，那就很简单，只需询问用户并给他们一个表单。

**(51:45 - 53:00)**

有些客户端是自动化的，有些是后台运行的，所以你如何处理 elicitation 实际上很复杂。如果你只是让 LLM 来填写，也许你满足了要求，也许没有，很难知道。

如果它被广泛使用，我绝对会说是的。它给你机会将特定的紧耦合参数放入 elicitation 提示中，或者确认。很多时候你会看到破坏性工具会有 confirm 选项，默认为 false，你强制 LLM 至少承认这一点，希望能将其引导到更理智的操作模式。elicitation 是更好的设计方式。

**(53:00 - 54:15)**

我不认为这出现在这些例子中的任何一个。很好的问题，希望我能说是，我希望能说是。你还有第二个问题。

**观众：** 在我的工作中，我主要做的是构建 agent，我使用 Dangra open SDK 之类的工具，我通常只是编写工具和调用 API 的工具，我不太看到 MCP 在那个领域的必要性。你是否认为 MCP 在那里不需要，或者你有什么看法？

**主持人：** 我认为我不会建议你编写 MCP 服务器。我认为在一年内，你选择编写 MCP 服务器的原因是因为你会获得更好的可观测性和对失败原因的理解。

**(54:15 - 55:30)**

而 agent 框架在这方面不太好，因为整个 agent 框架的部分工作就是不在工具调用时失败，而是将其反馈给 LLM，类似于我们刚才讨论的。所以你通常无法很好地观察工具调用失败。有些框架可以，但不是全部。

使用 MCP 服务器的原因之一，即使是在这样的本地情况下，就是因为现在你有了自动基础设施，所以你实际上可以调试和诊断。我不认为这是最强的理由。我认为这将在一年后生态系统更成熟时出现。

**(55:30 - 56:45)**

如果你完全控制客户端，进行客户端编排，编写 agentic 循环，并且你是唯一一个这样做的人，那就随你便。我认为你今天给出的所有建议也适用于构建工具时。

**主持人：** 绝对如此。我们今天说的所有内容都适用于 Python 工具。绝对如此。这就是 fastm 处理它的方式。这是个好问题。还有最后的问题吗？我很乐意回答。

**观众：** 是的，我对此感到兴奋。

**(56:45 - 58:00)**

**主持人：** code mode 是 Anthropic 的一个功能，实际上 Cloudflare 首先写了博客，然后 Anthropic 跟进，你实际上要求 LLM 编写代码来按顺序调用 MCP 工具，从而解决了我刚才描述的一些问题。这是对我刚才讨论的很多内容的一个非常有趣的绕过。

我不全心全意推荐它的原因是因为它带来了其他沙箱和代码执行的问题。有其他问题，但如果你有条件这样做，它可能非常酷。

**(58:00 - 59:15)**

实际上我有一位同事在那个功能发布的当天就写了一个支持它的 fastmcp 扩展，我们把它放在某个包里。起初我们不想把它放在 fastmcp main 中，因为我们不确定 - fastcp 试图有主见，我们不确定如何适配它，但实际上它非常成功，我们决定要在 CLI 中添加一个实验标志。

是的，这将进入这个新的 - 我忘了我们称它为 experiments 还是 optimize，它在我们的路线图上，这将包含在其中。然后现在有一整个世界在优化工具调用等等。

**(59:15 - End)**

但我想尊重大家的时间，让你们都能回到自己的生活中。感谢大家花一个小时和我讨论 MCP。如果有人有问题，我非常乐意继续交谈，但我想让大家从会议中解脱出来。希望大家喜欢这次演讲，非常感谢大家的参与。

---

*生成时间: 2026-01-13 00:13:38*
*由 YouTube Monitor & Translator (Claude CLI) 生成*